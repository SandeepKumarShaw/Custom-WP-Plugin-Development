<?php
//Job Post Form
function custom_job_post_form_field($post_id) {
	ob_start();
	
	if( $_REQUEST['id']!='' ) {
		$post_id = $_REQUEST['id'];
	}
	
	if($post_id != ''){
		$my_postid = $post_id;//This is page id or post id
		$content_post = get_post($my_postid);
		$content = $content_post->post_content;
	}
	?>
		<?php if($_REQUEST){ ?>
			<?php if( $post_id ){ ?>
				<h2 class="title">Update the job</h2>
				<span class="success_msg"> You have successfully updated this Job.<br/>Please wait for admin authorization to view this job.</span>
			<?php } else { ?>
				<h2 class="title">Post a new job</h2>
				<span class="success_msg"> You have successfully post a Job.<br/>Please wait for admin authorization to view this job.</span>
			<?php } ?>
		<?php } ?>
	
		<?php 
		// show any error messages after form submission
		job_post_error_messages();
		?>

		<form name="custom_job_post_form" id="custom_job_post_form" class="custom_reg_log_form" action="" method="POST" enctype="multipart/form-data">
			
			<input type="hidden" name="post_id" value="<?php echo $post_id;?>" readonly="readonly">
			<input type="hidden" id="ajax_url" name="ajax_url" value="<?php echo admin_url('admin-ajax.php'); ?>" readonly="readonly">
			<fieldset>
				<p>
					<label for="custom_job_post_title"><?php _e('Job Title <span class="required">*</span>'); ?></label>
					<input name="custom_job_post_title" id="custom_job_post_title" class="required" type="text" value="<?php if($content_post->post_title){ echo $content_post->post_title; } ?>" required/>
				</p>
                                <p>
					<label for="custom_job_post_descrip"><?php _e('Job Description <span class="required">*</span>'); ?></label>
					<?php /* ?>
					       <input name="custom_job_post_descrip" id="custom_job_post_descrip" class="required" type="text" value="<?php if($content_post->post_content){ echo $content_post->post_content; } ?>" required/>
					       <?php */ ?>
					
					<textarea name="custom_job_post_descrip" id="custom_job_post_descrip" class="required"><?php if($content_post->post_content){ echo trim($content_post->post_content); } ?></textarea>
				</p>
				
				
				<p>
					<label for="custom_job_post_require"><?php _e('Job Requirements <span class="required">*</span>'); ?></label>
					<input name="custom_job_post_require" id="custom_job_post_require" class="required" type="text" value="<?php if(get_post_meta($post_id,'jobs_manager_requirements',true)){ echo get_post_meta($post_id,'jobs_manager_requirements',true); } ?>" required/>
				</p>
				<?php /* ?>
                                <p>
					<label for="custom_job_post_comp_name"><?php _e('Company Name'); ?></label>
					<input name="custom_job_post_comp_name" id="custom_job_post_comp_name" type="text" value="<?php if(get_post_meta($p_id,'jobs_manager_company_name',true)){ echo get_post_meta($p_id,'jobs_manager_company_name',true); } ?>" />
				</p>
				<?php */ ?>
                                <p>
					<label for="custom_job_post_contact"><?php _e('Contact:'); ?></label>
					<input name="custom_job_post_contact" id="custom_job_post_contact" type="text" value="<?php if(get_post_meta($post_id,'jobs_manager_contact',true)){ echo get_post_meta($post_id,'jobs_manager_contact',true); } ?>" />
				</p>
				
				<p>	
					<label for="custom_job_start_date">Start Date: <span class="required">*</span> </label>
					<input name="custom_job_start_date" type="text" value="<?php if(get_post_meta($p_id,'jobs_manager_startdate',true)){ echo date("m-d-Y", strtotime(get_post_meta($p_id, "jobs_manager_startdate", true))); } ?>" class="startdate date_picker required" placeholder="mm/dd/yyyy" required>
				</p>

				<p>
					
					<label for="custom_job_end_date">End Date: <span class="required">*</span></label>
      <input name="custom_job_end_date" type="text" value="<?php if(get_post_meta($p_id,'jobs_manager_enddate',true)){ echo date("m-d-Y", strtotime(get_post_meta($p_id, "jobs_manager_enddate", true))); } ?>" class="enddate date_picker required" placeholder="mm/dd/yyyy" required>
				</p>
				<div class="gap">
					<label for="job_cat"><?php _e('Category'); ?></label>
					
					<?php $terms_list = get_terms( array(
						'taxonomy' => 'cptjobsmanager_category',
						'hide_empty' => false,
					    ) );
					//$selected_cat = $_POST["custom_job_category"];
					$selected_cat = wp_get_post_terms($post_id, 'cptjobsmanager_category', array("fields" => "slugs"));
					//print_r($selected_cat);	
					
					if($terms_list){
					?>
					<div class=checkbox-wrap>
						<?php
						foreach($terms_list as $single_term ){
							//print_r($single_term);
							if (in_array($single_term->slug, $selected_cat)) {						
							    $selected_item = ' checked="checked"';
							} else {
							    $selected_item = ' ';
							}
						?>
							<span><input name="custom_job_category[]" type="checkbox" value="<?php echo $single_term->slug ;?>" <?php echo $selected_item; ?> /><?php echo $single_term->name ;?></span>
						<?php } ?>
						
					</div>
					<?php
					}
					?>
				</div>
					
				<?php /* ?>
                                <p>
					<label for="custom_job_post_designatn"><?php _e('Job Designation'); ?></label>
					<input name="custom_job_post_designatn" id="custom_job_post_designatn" type="text" value="<?php if(get_post_meta($p_id,'jobs_manager_designation',true)){ echo get_post_meta($p_id,'jobs_manager_designation',true); } ?>" />
				</p>
				<?php */ ?>
				
				<p>
					<label for="custom_job_post_salary"><?php _e('Salary'); ?></label>
					<input name="custom_job_post_salary" id="custom_job_post_salary" type="text" value="<?php if(get_post_meta($post_id,'jobs_manager_salary',true)){ echo get_post_meta($post_id,'jobs_manager_salary',true); } ?>" />
				</p>
				<!--
                                <p>
					<label for="custom_job_post_department"><?php //_e('Job Department'); ?></label>
					<input name="custom_job_post_department" id="custom_job_post_department" type="text" value="<?php //if(get_post_meta($p_id,'jobs_manager_department',true)){ echo get_post_meta($p_id,'jobs_manager_department',true); } ?>" />
				</p>
				-->
                                <p>
					<label for="custom_job_post_loc"><?php _e('Job Location <span class="required">*</span>'); ?></label>
					<input name="custom_job_post_loc" id="custom_job_post_loc" class="required" type="text" value="<?php if(get_post_meta($p_id,'jobs_manager_location',true)){ echo get_post_meta($p_id,'jobs_manager_location',true); } ?>" required/>
				</p>
				
                                <p>
					<label for="custom_job_Year_expr"><?php _e('Years of Experience Required <span class="required">*</span>'); ?></label>
					<input name="custom_job_Year_expr" id="custom_job_Year_expr" class="required" type="text" value="<?php if(get_post_meta($post_id,'jobs_manager_experience',true)){ echo get_post_meta($post_id,'jobs_manager_experience',true); } ?>" required />
				</p>
				<!--
                                <p>
					<label for="custom_job_vacancy"><?php //_e('Job Vacancy'); ?></label>
					<input name="custom_job_vacancy" id="custom_job_vacancy" type="text" value="<?php //if(get_post_meta($p_id,'jobs_manager_vacancy',true)){ echo get_post_meta($p_id,'jobs_manager_vacancy',true); } ?>" />
				</p>                               
				-->
				<p>
					<input type="hidden" name="custom_job_post_nonce" value="<?php echo wp_create_nonce('custom_job_post_nonce'); ?>"/>
					<?php if( $post_id ){ ?>
					<input type="submit" name="submit_job_post" value="<?php _e('Update Post'); ?>"/>
					<?php } else { ?>
					<input type="submit" name="submit_job_post" value="<?php _e('Submit Post'); ?>"/>
					<?php } ?>
				</p>
			</fieldset>
		</form>
	<?php
	return ob_get_clean();
}
?>